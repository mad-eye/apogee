<?xml version="1.0" encoding="UTF-8"?>
        <!-- Copyright 2012 Google Inc. All Rights Reserved -->
    	<Module>
    	  <ModulePrefs title="Face Movement" height="200" width="550">
    	  <Require feature="rpc"/>
          <Require feature="views" />
    	</ModulePrefs>
    	<Content type="html"><![CDATA[
<!DOCTYPE html>

<script src="https://talkgadget.google.com/hangouts/_/api/hangout.js?v=1.2" ></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<iframe id="theIFrame" frameborder="no" scrolling="yes" 
        src="" style="width:100%;"></iframe>
<script>var appData = gadgets.views.getParams()['appData'];
console.log("appData", appData);
var projectUrl = appData;
var theIFrame = document.getElementById("theIFrame");
if (appData){
    gapi.hangout.data.setValue("projectUrl", appData);
    theIFrame.src = appData;
    $(frames[0].window).ready(function(){
        console.log("setting iframe height", document.height + "px");
	theIFrame.style.height = document.height + "px";
    });
}
//this feels really hacky..i hope there's a better way
else {
    var intervalId = setInterval(function(){
        var state = gapi.hangout.data.getState();
        if (state){
            clearInterval(intervalId);
            projectUrl = state.projectUrl
            theIFrame.src = projectUrl;
            $(frames[0].window).ready(function(){
                console.log("setting iframe height", document.height + "px");
                theIFrame.style.height = document.height + "px";
            });
        }
    }, 200);
}
</script>
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<br/>
]]></Content></Module>
